#!/usr/bin/env bash
set -e

red='\033[0;31m'
green='\033[0;32m'
nc='\033[0m'

log() {
  args=("$@")
  # shellcheck disable=SC2145
  echo -e "${green} ${args[@]}${nc}" 1>&2
}

log_err() {
  args=("$@")
  # shellcheck disable=SC2145
  echo -e "${red} ${args[@]}${nc}" 1>&2
}

cwd="$(cd "$(dirname "$0")" && pwd)"

cd "$1"

# load config
. "$cwd"/config

export AWS_PAGER=""

aws cloudwatch put-metric-data --namespace "$namespace" --metric-name "$metric" --value "$value" --unit "$unit" --dimensions "$dimensions"

log "placed AWS cloudwatch metric '${metric}' to namespace '${namespace}', dimensions: ${dimensions}"

echo "{\"version\":{\"ref\":\"${version}\"}}"
exit 0
